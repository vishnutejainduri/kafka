packages:
  product-consumers:
    dependencies:
      openwhisk-messagehub:
        location: /whisk.system/messaging
        inputs:
          kafka_brokers_sasl: $KAFKA_BROKERS_SASL
          user: $KAFKA_USERNAME
          password: $KAFKA_PASSWORD
          kafka_admin_url: https://kafka-admin-prod01.messagehub.services.us-south.bluemix.net:443
    actions:
      consume-catalog-message:
        location: ./consumeCatalogMessage.js
        runtime: nodejs:10
        inputs:
          mongoUri: $MONGO_URI
          dbName: $DB_NAME
          collectionName: styles
          topicName: styles-connect-jdbc-CATALOG
      consume-sku-inventory-message:
        location: ./consumeSkuInventoryMessage.js
        runtime: nodejs:10
        inputs:
          mongoUri: $MONGO_URI
          dbName: $DB_NAME
          collectionName: inventory
          topicName: inventory-connect-jdbc-SKUINVENTORY
      update-algolia-style:
        location: ./updateAlgoliaStyle/dist/bundle.js
        runtime: nodejs:10
        inputs:
          topicName: styles-connect-jdbc-CATALOG
          algoliaApiKey: $ALGOLIA_API_KEY
          algoliaIndexName: $ALGOLIA_INDEX_NAME
          algoliaAppId: $ALGOLIA_APP_ID
      update-algolia-inventory:
        location: ./updateAlgoliaInventory/dist/bundle.js
        runtime: nodejs:10
        inputs:
          topicName: inventory-connect-jdbc-SKUINVENTORY
          algoliaApiKey: $ALGOLIA_API_KEY
          algoliaIndexName: $ALGOLIA_INDEX_NAME
          algoliaAppId: $ALGOLIA_APP_ID
    triggers:
      catalog-trigger:
        feed: openwhisk-messagehub/messageHubFeed
        inputs:
          isJSONData: true
          topic: styles-connect-jdbc-CATALOG
