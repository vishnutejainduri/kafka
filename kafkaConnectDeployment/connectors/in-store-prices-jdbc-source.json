{
  "name": "in-store-prices-jdbc-source",
  "config": {
    "connector.class": "io.confluent.connect.jdbc.JdbcSourceConnector",
    "tasks.max": 1,
    "connection.url": "jdbc:oracle:thin:<DB_USERNAME>/<DB_PASSWORD>@//<DB_HOST_IP>:1521/<DB_SERVICE_NAME>",
    "mode": "bulk",
    "batch.max.rows": 1000,
    "topic.prefix": "prices-connect-jdbc",
    "validate.non.null": "false",
    "errors.log.enable": true,
    "numeric.mapping": "best_fit",
    "query": "SELECT sc3.IMAGE_STYLEID AS STYLE_ID, NEW_RETAIL_PRICE, START_DATE, '00011' AS SITE_ID FROM MERCH.IRO_POS_STYLES INNER JOIN ELCAT.STYLE_COLOURS@BEANS.HARRYROSEN.COM sc3 ON TO_NUMBER(SUBSTR(sc3.STYLEID,1,8)) = IRO_POS_STYLES.STYLE_ID AND sc3.COLOUR_ID = IRO_POS_STYLES.COLOR_ID LEFT JOIN (SELECT sc2.IMAGE_STYLEID AS STYLE_ID, ipp.NEW_RETAIL_PRICE, ipp.START_DATE, ipp.SITE_ID  FROM (SELECT sc.IMAGE_STYLEID AS STYLE_ID, MAX(START_DATE) AS START_DATE FROM MERCH.IRO_POS_PRICES  INNER JOIN ELCAT.STYLE_COLOURS@BEANS.HARRYROSEN.COM sc ON TO_NUMBER(SUBSTR(sc.STYLEID,1,8)) = STYLE_ID AND sc.COLOUR_ID = COLOR_ID  WHERE SITE_ID = '00011' AND BUSINESS_UNIT_ID = 1 AND TRUNC(SYSDATE) BETWEEN START_DATE AND NVL(END_DATE, DATE'2525-01-01')  GROUP BY sc.IMAGE_STYLEID) currentpricespan INNER JOIN ELCAT.STYLE_COLOURS@BEANS.HARRYROSEN.COM sc2 ON currentpricespan.STYLE_ID = sc2.IMAGE_STYLEID LEFT JOIN MERCH.IRO_POS_PRICES ipp ON TO_NUMBER(SUBSTR(sc2.STYLEID,1,8)) = ipp.STYLE_ID AND sc2.COLOUR_ID = ipp.COLOR_ID AND currentpricespan.START_DATE = ipp.START_DATE WHERE SUBSTR(ipp.NEW_RETAIL_PRICE, -1) = '9' AND SITE_ID = '00011'GROUP BY sc2.IMAGE_STYLEID, ipp.NEW_RETAIL_PRICE, ipp.START_DATE, ipp.SITE_ID ORDER BY sc2.IMAGE_STYLEID) instoresales ON instoresales.STYLE_ID = sc3.IMAGE_STYLEID GROUP BY sc3.IMAGE_STYLEID, NEW_RETAIL_PRICE, START_DATE, SITE_ID",
    "poll.interval.ms": 10800000,
    "offset.flush.timeout.ms": 120000
  }
}
